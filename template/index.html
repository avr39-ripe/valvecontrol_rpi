<!doctype html>
<html>
    <head>
        <title>Tornado Chat</title>
        <script type="text/javascript" src="/static/jquery-1.10.2.min.js"></script>
        <script type="text/javascript">
        function ConvertFormToJSON(form){
            var array = jQuery(form).serializeArray();
            var json = {};
    
            jQuery.each(array, function() {
            json[this.name] = this.value || '';
            });
    
            return json;
        }

        jQuery(document).on('ready', function() {
            jQuery('form#config').bind('submit', function(event){
                event.preventDefault();
        
                var form = this;
                var json = ConvertFormToJSON(form);
                $.ajax({
                    url: '/config',
                    type: 'POST',
                    data: JSON.stringify(json),
                    contentType: 'application/json; charset=utf-8',
                    dataType: 'json'
                });
                return true;
            });
        });
        </script>
    </head>
    <body>
        <h1 style="text-align:center">ValveControl</h1>

        <form id="config">
            <p style="text-align:center">
            <label for="temp_set">Target temperature, C:</label>
            <input id="temp_set" name="temp_set" type="text" value="36.0"><br>
            <label for="temp_delta">Target temperature delta, C:</label>
            <input id="temp_delta" name="temp_delta" type="text" value="1.5"><br>
            <label for="delay">Delay of iteration time, sec:</label>
            <input id="delay" name="delay" type="text" value="5.0"><br>
            <label for="missed_delay">Delay to off the valve, sec:</label>
            <input id="missed_delay" name="missed_delay" type="text" value="5.0"><br>
            <label for="missed_stabilize_delay">Delay for temperature stabilization, sec:</label>
            <input id="missed_stabilize_delay" name="missed_stabilize_delay" type="text" value="15.0"><br>
            <br />
            <input type="submit" value="Apply">
            </p>
        </form>
        <h2 style="text-align:center" id='temp'>TEMP</h2>
        <script>
             $( document ).ready(loadTemp());
        
            function loadTemp(){
                $.getJSON("/temp", 
                    function(data) {
                    $('#temp').text('Current temperature, C: ' + data.curr_temp );
                }); 
                setTimeout("loadTemp()",5000);
            }
        </script>
    </body>
</html>
